<!-- 2026 New Year's Resolutions -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <title>2026 New Year's Resolutions</title>
    <script src="https://unpkg.com/typeit@8.7.1/dist/index.umd.js"></script>
    <style>
        body{
            margin:0;
            padding:0;
            color:black;
            font-size:20px;
            overflow:hidden;
        }

        a{
            color:black;
            text-decoration:none;
        }

        a:hover{
            text-decoration:underline;
        }

        ::selection{
            background-color:rgb(233, 233, 233);
        }

        .container{
            width:100vw;
            height:100dvh;
            display:flex;
            justify-content:center;
            align-items:center;
            flex-direction:column;
        }

        .text{
            text-align:center;
            padding:50px;
        }

        .button-wrapper{
            position:fixed;
            bottom:20px;
            display:flex;
            flex-direction:row;
            gap:10px;
        }

        button{
            font-family:arial;
            background-color:rgb(233, 233, 233);
            border:0;
            padding:2px 5px;
            cursor:pointer;
            color:black;
        }

        button a:hover{
            text-decoration:none;
        }

        @media only screen and (max-width:600px){
            body{
                font-size:30px;
            }

            button{
                font-size:20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="text">
            <p>In 2026,&nbsp;<span id="typewriter"></span></p>
        </div>
        <div class="button-wrapper">
            <button id="randomize">random</button>
            <button><a href="https://are.na/ryan-yan/2026-new-year-s-resolutions" target="_blank" style="color:blue">add yours</a></button>
        </div>
    </div>
    <script>
        let channelData;
        let typeItInstance;
        let shuffledIndex = [];
        let currentIndex = 0;

        fetch("https://api.are.na/v3/channels/2026-new-year-s-resolutions/contents?per=100")
        .then(res => res.json())
        .then(channel => {
            channelData = channel.data;
            shuffleIndex();
            loadResolution();
        });

        function shuffleIndex(){
            shuffleIndex = Array.from({length:channelData.length}, (_, i) => i);
    
            for(let i = shuffleIndex.length - 1; i > 0; i--){
                const j = Math.floor(Math.random() * (i + 1));
                [shuffleIndex[i], shuffleIndex[j]] = [shuffleIndex[j], shuffleIndex[i]];
            }
            
            currentIndex = 0;
        }

        function loadResolution(){
            if(typeItInstance){
                typeItInstance.destroy();
            }

            document.getElementById('typewriter').textContent = '';

            const channelLength = channelData.length;
            const currentBlock = shuffleIndex[currentIndex];

            currentIndex++;

            if(currentIndex >= shuffleIndex.length){
                shuffleIndices();
            }

            let resolutionText = channelData[currentBlock].content.plain;
            
            function formatResolution(text){
                const parts = [];
                let currentPart = '';
                let insideQuotes = false;
                let quoteChar = null;
                
                for(let i = 0; i < text.length; i++){
                    const char = text[i];
                    
                    const isContraction = char === "'" && i > 0 && i < text.length - 1 && /[a-z]/i.test(text[i-1]) && /[a-z]/i.test(text[i+1]);
                    
                    //don't change any pronouns inside of quotes
                    if((char === '"' || (char === "'" && !isContraction)) && (quoteChar === null || quoteChar === char)){
                        if(!insideQuotes){
                            //enter quotes
                            parts.push({text:currentPart, quoted:false});
                            currentPart = char;
                            insideQuotes = true;
                            quoteChar = char;
                        }else{
                            //exit quotes
                            currentPart += char;
                            parts.push({text:currentPart, quoted:true});
                            currentPart = '';
                            insideQuotes = false;
                            quoteChar = null;
                        }
                    }else{
                        currentPart += char;
                    }
                }
                
                if(currentPart){
                    parts.push({text:currentPart, quoted:insideQuotes});
                }
                
                let formatted = parts.map(part => {
                    if(part.quoted){
                        return part.text;
                    }
                    
                    //change first person pronouns to gender neutral third person
                    //this adjustment *usually* works with the site's sentence structure but not always (edge cases?)
                    return part.text
                        .replace(/\bmy\b/gi, 'their')
                        .replace(/\bme\b/gi, 'them')
                        .replace(/\bmine\b/gi, 'theirs')
                        .replace(/\bmyself\b/gi, 'themselves')
                        .replace(/\bi'm\b/gi, 'they\'re')
                        .replace(/\bi'll\b/gi, 'they\'ll')
                        .replace(/\bi've\b/gi, 'they\'ve')
                        .replace(/\bi'd\b/gi, 'they\'d')
                        .replace(/\bi am\b/gi, 'they are')
                        .replace(/\bi was\b/gi, 'they were')
                        .replace(/\bi\b(?![''])/gi, 'they');
                }).join('');
                
                const firstWordMatch = formatted.match(/^\s*(\S+)/);
                
                if(firstWordMatch){
                    const firstWord = firstWordMatch[1];
                    const isAllCaps = firstWord === firstWord.toUpperCase() && /[A-Z]/.test(firstWord);
                    if(firstWord[0] === firstWord[0].toUpperCase() && !isAllCaps){
                        formatted = formatted.replace(/^\s*\S+/, firstWord[0].toLowerCase() + firstWord.slice(1));
                    }
                }
                
                //check if text ends with punctuation
                const endsWithPunctuation = /[.?!\-]\s*$/.test(formatted);
                if(!endsWithPunctuation){
                    formatted = formatted.trimEnd() + '.';
                }
                
                return formatted;
            }
            
            let formattedResolution = formatResolution(resolutionText);
            const userText = channelData[currentBlock].user.name;
            const userSlug = channelData[currentBlock].user.slug;

            const fullText = `<a href="https://are.na/${userSlug}" target="_blank">${userText}</a> wants to ${formattedResolution}`;
                        
            typeItInstance = new TypeIt("#typewriter", {
                strings:fullText,
                speed:25,
                waitUntilVisible:true,
                cursor:false
            }).go();

            console.log(`${currentBlock}. ${resolutionText}`);
        }

        document.getElementById('randomize').addEventListener('click', () => {
            loadResolution();
        });
    </script>
</body>
</html>